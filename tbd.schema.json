{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "id": "https://github.com/rd2/tbd/blob/master/tbd.schema.json",
  "title": "TBD Schema",
  "description": "Schema for Thermal Bridging and Derating",
  "type": "object",
  "properties": {
    "description": {
      "type": "string"
    },
    "schema": {
      "type": "string"
    },
    "psis": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/PSI"
      },
      "uniqueItems": true
    },
    "khis": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/KHI"
      },
      "uniqueItems": true
    },
    "edges": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Edge"
      },
      "uniqueItems": true
    },
    "surfaces": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Surface"
      },
      "uniqueItems": true
    },
    "spaces": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Space"
      },
      "uniqueItems": true
    },
    "stories": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Story"
      },
      "uniqueItems": true
    },
    "units": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Unit"
      },
      "uniqueItems": true
    },
    "logs": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Log"
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "PSI": {
      "description": "Set of PSI-values (in W/K per m) for thermal bridges",
      "type": "object",
      "required": [
        "id"
      ],
      "properties": {
        "id": {
          "title": "Unique PSI set identifier",
          "type": "string"
        },
        "rimjoist": {
          "title": "Floor/wall edge PSI",
          "type": "number",
          "minimum": 0
        },
        "parapet": {
          "title": "Roof/wall or exposed-floor/wall edge PSI",
          "type": "number",
          "minimum": 0
        },
        "fenestration": {
          "title": "Window, door, skylight perimeter PSI",
          "type": "number",
          "minimum": 0
        },
        "concave": {
          "title": "Wall corner [0째,135째) PSI",
          "type": "number",
          "minimum": 0
        },
        "convex": {
          "title": "Wall corner (225째,360째] PSI",
          "type": "number",
          "minimum": 0
        },
        "balcony": {
          "title": "Floor/balcony edge PSI ",
          "type": "number",
          "minimum": 0
        },
        "party": {
          "title": "Party wall edge PSI",
          "type": "number",
          "minimum": 0
        },
        "grade": {
          "title": "Floor/foundation edge PSI",
          "type": "number",
          "minimum": 0
        }
      },
      "minProperties": 2,
      "additionalProperties": false
    },
    "KHI": {
      "description": "KHI-value (in W/K) for a point thermal bridge",
      "type": "object",
      "required": [
        "id",
        "point"
      ],
      "properties": {
        "id": {
          "title": "Unique KHI identifier",
          "type": "string"
        },
        "point": {
          "title": "Point KHI",
          "type": "number",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "Edge": {
      "description": "Surface edge as thermal bridge",
      "type": "object",
      "required": [
        "psis"
      ],
      "properties": {
        "psis": {
          "title": "PSI-set ID",
          "type": "string"
        },
        "length": {
          "title": "edge length (m)",
          "type": "number",
          "minimum": 0,
          "exclusiveMinimum": true
        },
        "rimjoist": {
          "title": "edge as rimjoist?",
          "type": "boolean"
        },
        "parapet": {
          "title": "edge as parapet?",
          "type": "boolean"
        },
        "fenestration": {
          "title": "edge as fenestration?",
          "type": "boolean"
        },
        "concave": {
          "title": "edge as concave corner?",
          "type": "boolean"
        },
        "convex": {
          "title": "edge as convex corner?",
          "type": "boolean"
        },
        "balcony": {
          "title": "edge as balcony?",
          "type": "boolean"
        },
        "party": {
          "title": "edge as party wall edge?",
          "type": "boolean"
        },
        "grade": {
          "title": "edge as grade edge?",
          "type": "boolean"
        },
        "surfaces": {
          "title": "surfaces connected to edge",
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1
        }
      },
      "additionalProperties": false
    },
    "Surface": {
      "description": "Surface default PSI-set (optional)",
      "type": "object",
      "required": [
        "id",
        "psis"
      ],
      "properties": {
        "id": {
          "title": "e.g. OS or E+ surface ID",
          "type": "string"
        },
        "psis": {
          "title": "PSI-set ID",
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Space": {
      "description": "Space default PSI-set (optional for OS)",
      "type": "object",
      "required": [
        "id",
        "psis"
      ],
      "properties": {
        "id": {
          "title": "e.g. OS space or E+ zone ID",
          "type": "string"
        },
        "psis": {
          "title": "PSI-set ID",
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Story": {
      "title": "Story default PSI-set (optional for OS)",
      "type": "object",
      "required": [
        "id",
        "psis"
      ],
      "properties": {
        "id": {
          "title": "e.g. OS story ID",
          "type": "string"
        },
        "psis": {
          "title": "PSI-set ID",
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Unit": {
      "title": "Building unit default PSI-set (optional for OS)",
      "type": "object",
      "required": [
        "id",
        "psis"
      ],
      "properties": {
        "id": {
          "title": "e.g. OS unit ID",
          "type": "string"
        },
        "psis": {
          "title": "PSI-set ID",
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Log": {
      "title": "TBD log messages",
      "type": "string"
    }
  }
}
