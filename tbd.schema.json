{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "id": "https://github.com/rd2/tbd/blob/master/tbd.schema.json",
  "title": "TBD Schema",
  "description": "Schema for Thermal Bridging and Derating",
  "type": "object",
  "properties": {
    "description": {
      "type": "string"
    },
    "schema": {
      "type": "string"
    },
    "psis": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/PSI"
      },
      "uniqueItems": true
    },
    "khis": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/KHI"
      },
      "uniqueItems": true
    },
    "edges": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Edge"
      },
      "uniqueItems": true
    },
    "surfaces": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Surface"
      },
      "uniqueItems": true
    },
    "spaces": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Space"
      },
      "uniqueItems": true
    },
    "spacetypes": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SpaceType"
      },
      "uniqueItems": true
    },
    "stories": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Story"
      },
      "uniqueItems": true
    },
    "building": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Building"
      },
      "uniqueItems": true
    },
    "logs": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Log"
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "PSI": {
      "description": "Set of PSI-values (in W/K per m) for thermal bridges",
      "type": "object",
      "properties": {
        "id": {
          "title": "Unique PSI set identifier",
          "type": "string"
        },
        "rimjoist": {
          "title": "Floor/wall edge PSI",
          "type": "number"
        },
        "parapet": {
          "title": "Roof/wall or exposed-floor/wall edge PSI",
          "type": "number"
        },
        "fenestration": {
          "title": "Window, door, skylight perimeter PSI",
          "type": "number"
        },
        "concave": {
          "title": "Wall corner [0째,135째) PSI",
          "type": "number"
        },
        "convex": {
          "title": "Wall corner (225째,360째] PSI",
          "type": "number"
        },
        "balcony": {
          "title": "Floor/balcony edge PSI ",
          "type": "number"
        },
        "party": {
          "title": "Party wall edge PSI",
          "type": "number"
        },
        "grade": {
          "title": "Floor/foundation edge PSI",
          "type": "number"
        }
      },
      "additionalProperties": false,
      "required": [
        "id"
      ],
      "minProperties": 2
    },
    "KHI": {
      "description": "KHI-value (in W/K) for a point thermal bridge",
      "type": "object",
      "properties": {
        "id": {
          "title": "Unique KHI identifier",
          "type": "string"
        },
        "point": {
          "title": "Point KHI-value",
          "type": "number"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "point"
      ]
    },
    "Edge": {
      "description": "Surface(s) edge as thermal bridge",
      "type": "object",
      "properties": {
        "psi": {
          "title": "PSI-set identifier",
          "type": "string"
        },
        "type": {
          "title": "PSI-set type, e.g. 'parapet'",
          "type": "string",
          "enum": [
            "rimjoist",
            "parapet",
            "fenestration",
            "concave",
            "convex",
            "balcony",
            "party",
            "grade"
          ]
        },
        "length": {
          "title": "Edge length (m), > 0 m",
          "type": "number",
          "minimum": 0,
          "exclusiveMinimum": true
        },
        "v0x": {
          "title": "Edge origin X vertex (m)",
          "type": "number"
        },
        "v0y": {
          "title": "Edge origin Y vertex (m)",
          "type": "number"
        },
        "v0z": {
          "title": "Edge origin Z vertex (m)",
          "type": "number"
        },
        "v1x": {
          "title": "Edge terminal X vertex (m)",
          "type": "number"
        },
        "v1y": {
          "title": "Edge terminal Y vertex (m)",
          "type": "number"
        },
        "v1z": {
          "title": "Edge terminal Z vertex (m)",
          "type": "number"
        },
        "surfaces": {
          "title": "Surface(s) connected to edge",
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "uniqueItems": true
        }
      },
      "additionalProperties": false,
      "required": [
        "type",
        "surfaces"
      ]
    },
    "Surface": {
      "description": "Surface default PSI-set (optional)",
      "type": "object",
      "properties": {
        "id": {
          "title": "e.g. OS or E+ surface identifier",
          "type": "string"
        },
        "psi": {
          "title": "PSI-set identifier",
          "type": "string"
        },
        "khis": {
          "title": "Surface-hosted point thermal bridges",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "title": "Unique KHI-value identifier",
                "type": "string"
              },
              "count": {
                "title": "Number of KHI-matching point thermal bridges",
                "type": "number",
                "minimum": 1
              }
            },
            "additionalProperties": false,
            "required": [
              "id",
              "count"
            ]
          },
          "uniqueItems": true
        }
      },
      "additionalProperties": false,
      "minProperties": 2,
      "required": [
        "id"
      ]
    },
    "Space": {
      "description": "Space default PSI-set (optional for OS)",
      "type": "object",
      "properties": {
        "id": {
          "title": "e.g. OS space or E+ zone identifier",
          "type": "string"
        },
        "psi": {
          "title": "PSI-set identifier",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "psi"
      ]
    },
    "SpaceType": {
      "description": "SpaceType default PSI-set (optional for OS)",
      "type": "object",
      "properties": {
        "id": {
          "title": "e.g. OS spacetype identifier",
          "type": "string"
        },
        "psi": {
          "title": "PSI-set identifier",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "psi"
      ]
    },
    "Story": {
      "description": "Story default PSI-set (optional for OS)",
      "type": "object",
      "properties": {
        "id": {
          "title": "e.g. OS story identifier",
          "type": "string"
        },
        "psi": {
          "title": "PSI-set identifier",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "id",
        "psi"
      ]
    },
    "Building": {
      "description": "Building default PSI-set (optional for OS)",
      "type": "object",
      "properties": {
        "psi": {
          "title": "PSI-set identifier",
          "type": "string"
        }
      },
      "additionalProperties": false,
      "required": [
        "psi"
      ]
    },
    "Log": {
      "description": "TBD log messages",
      "type": "string"
    }
  }
}
